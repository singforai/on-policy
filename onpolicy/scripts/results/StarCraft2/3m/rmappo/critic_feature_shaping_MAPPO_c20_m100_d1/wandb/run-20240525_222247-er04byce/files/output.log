/home/uosai/Desktop/on-policy/onpolicy/envs/starcraft2/StarCraft2_Env.py:462: DeprecationWarning: Conversion of an array with ndim > 0 to a scalar is deprecated, and will error in future. Ensure you extract a single element from your array before performing this operation. (Deprecated NumPy 1.25.)
  actions_int = [int(a) for a in actions]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.32876712]
  [0.32876712]
  [0.32876712]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.32876712]
  [0.32876712]
  [0.32876712]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.32876712]
  [0.32876712]
  [0.32876712]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.32876712]
  [0.32876712]
  [0.32876712]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
 Map 3m Algo rmappo Exp critic_feature_shaping_MAPPO_c20_m100_d1 updates 0/20000 episodes, total num timesteps 100/2000000, FPS 59.
incre win rate is 0.0.
/home/uosai/Desktop/miniconda3/envs/marl/lib/python3.9/site-packages/wandb/util.py:449: DeprecationWarning:
Pyarrow will become a required dependency of pandas in the next major release of pandas (pandas 3.0),
(to allow more performant data types, such as the Arrow string type, and better interoperability with other libraries)
but was not found to be installed on your system.
If this would cause problems for you,
please provide us feedback at https://github.com/pandas-dev/pandas/issues/54466
  import pandas as pd
/home/uosai/Desktop/on-policy/onpolicy/envs/starcraft2/StarCraft2_Env.py:462: DeprecationWarning: Conversion of an array with ndim > 0 to a scalar is deprecated, and will error in future. Ensure you extract a single element from your array before performing this operation. (Deprecated NumPy 1.25.)
  actions_int = [int(a) for a in actions]
/home/uosai/Desktop/on-policy/onpolicy/runner/shared/_reward_function.py:76: RuntimeWarning: divide by zero encountered in divide
  self.centroids_max_R = ((self.decay_rate * np.array(self.cluster_max_R)) + ((1 - self.decay_rate) * np.array(self.centroids_max_R)))/((1 - self.decay_rate**self.nth_clustering))
/home/uosai/Desktop/on-policy/onpolicy/runner/shared/_reward_function.py:76: RuntimeWarning: invalid value encountered in divide
  self.centroids_max_R = ((self.decay_rate * np.array(self.cluster_max_R)) + ((1 - self.decay_rate) * np.array(self.centroids_max_R)))/((1 - self.decay_rate**self.nth_clustering))
/home/uosai/Desktop/on-policy/onpolicy/runner/shared/_reward_function.py:78: RuntimeWarning: invalid value encountered in divide
  self.centroids_min_R = ((self.decay_rate * np.array(self.cluster_min_R)) + ((1 - self.decay_rate) * np.array(self.centroids_min_R)))/((1 - self.decay_rate**self.nth_clustering))
eval win rate is 0.0.
[[[0.]
  [0.]
  [0.]]]
[[[0.32876712]
  [0.32876712]
  [0.32876712]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.32876712]
  [0.32876712]
  [0.32876712]]]
[[[0.]
  [0.]
  [0.]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[0.16438356]
  [0.16438356]
  [0.16438356]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[0.]
  [0.]
  [0.]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[0.16438356]
  [0.16438356]
  [0.16438356]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.32876712]
  [0.32876712]
  [0.32876712]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.32876712]
  [0.32876712]
  [0.32876712]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.32876712]
  [0.32876712]
  [0.32876712]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[0.16438356]
  [0.16438356]
  [0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[0.16438356]
  [0.16438356]
  [0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[0.16438356]
  [0.16438356]
  [0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.32876712]
  [0.32876712]
  [0.32876712]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[0.16438356]
  [0.16438356]
  [0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.32876712]
  [0.32876712]
  [0.32876712]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.32876712]
  [0.32876712]
  [0.32876712]]]
[[[0.]
  [0.]
  [0.]]]
[[[0.32876712]
  [0.32876712]
  [0.32876712]]]
[[[0.]
  [0.]
  [0.]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
/home/uosai/Desktop/on-policy/onpolicy/runner/shared/_reward_function.py:76: RuntimeWarning: invalid value encountered in multiply
  self.centroids_max_R = ((self.decay_rate * np.array(self.cluster_max_R)) + ((1 - self.decay_rate) * np.array(self.centroids_max_R)))/((1 - self.decay_rate**self.nth_clustering))
/home/uosai/Desktop/on-policy/onpolicy/algorithms/r_mappo/r_mappo.py:180: RuntimeWarning: Mean of empty slice
  mean_advantages = np.nanmean(advantages_copy)
/home/uosai/Desktop/miniconda3/envs/marl/lib/python3.9/site-packages/numpy/lib/nanfunctions.py:1879: RuntimeWarning: Degrees of freedom <= 0 for slice.
  var = nanvar(a, axis=axis, dtype=dtype, out=out, ddof=ddof,
Traceback (most recent call last):
  File "/home/uosai/Desktop/on-policy/onpolicy/scripts/train/train_smac.py", line 289, in <module>
    main(sys.argv[1:])
  File "/home/uosai/Desktop/on-policy/onpolicy/scripts/train/train_smac.py", line 274, in main
    runner.run()
  File "/home/uosai/Desktop/on-policy/onpolicy/runner/shared/smac_runner.py", line 54, in run
    train_infos = self.train()
  File "/home/uosai/Desktop/on-policy/onpolicy/runner/shared/base_runner.py", line 187, in train
    train_infos = self.trainer.train(self.buffer)
  File "/home/uosai/Desktop/on-policy/onpolicy/algorithms/r_mappo/r_mappo.py", line 205, in train
    = self.ppo_update(sample, update_actor)
  File "/home/uosai/Desktop/on-policy/onpolicy/algorithms/r_mappo/r_mappo.py", line 115, in ppo_update
    values, action_log_probs, dist_entropy = self.policy.evaluate_actions(share_obs_batch,
  File "/home/uosai/Desktop/on-policy/onpolicy/algorithms/r_mappo/algorithm/rMAPPOPolicy.py", line 111, in evaluate_actions
    action_log_probs, dist_entropy = self.actor.evaluate_actions(obs,
  File "/home/uosai/Desktop/on-policy/onpolicy/algorithms/r_mappo/algorithm/r_actor_critic.py", line 111, in evaluate_actions
    action_log_probs, dist_entropy = self.act.evaluate_actions(actor_features,
  File "/home/uosai/Desktop/on-policy/onpolicy/algorithms/utils/act.py", line 171, in evaluate_actions
    action_logits = self.action_out(x, available_actions)
  File "/home/uosai/Desktop/miniconda3/envs/marl/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/uosai/Desktop/miniconda3/envs/marl/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/uosai/Desktop/on-policy/onpolicy/algorithms/utils/distributions.py", line 68, in forward
    return FixedCategorical(logits=x)
  File "/home/uosai/Desktop/miniconda3/envs/marl/lib/python3.9/site-packages/torch/distributions/categorical.py", line 70, in __init__
    super().__init__(batch_shape, validate_args=validate_args)
  File "/home/uosai/Desktop/miniconda3/envs/marl/lib/python3.9/site-packages/torch/distributions/distribution.py", line 68, in __init__
    raise ValueError(
ValueError: Expected parameter logits (Tensor of shape (300, 9)) of distribution FixedCategorical(logits: torch.Size([300, 9])) to satisfy the constraint IndependentConstraint(Real(), 1), but found invalid values:
tensor([[nan, nan, nan,  ..., nan, nan, nan],
        [nan, nan, nan,  ..., nan, nan, nan],
        [nan, nan, nan,  ..., nan, nan, nan],
        ...,
        [nan, nan, nan,  ..., nan, nan, nan],
        [nan, nan, nan,  ..., nan, nan, nan],
        [nan, nan, nan,  ..., nan, nan, nan]], device='cuda:0',
[[[nan]6438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[-0.16438356]
  [-0.16438356]
  [-0.16438356]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]6438356]]]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]
[[[nan]
  [nan]
  [nan]]]